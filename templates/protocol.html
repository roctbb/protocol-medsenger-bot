<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Измерение давления</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script
            src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>

    <style>
        th, td {
            padding: 4px;
        }

        li {
            font-size: 80%;
        }
    </style>
</head>
<body>
<div class="container" style="margin-top: 15px;" id="app">
    <h3>{{ protocol.title }}</h3>

    <p class="text-muted">{{ protocol.description }} </p>

    <p>Всего событий - {{ stats['total'] }}, выполнено в срок - {{ stats['done'] }}, с задержкой - {{ stats['delayed'] }}, пропущено - {{ stats['failed'] }} </p>

    <table valign="top" class="table-striped" style="width: 100%;">
        <tr>
            <th>Медицинское мероприятие</th>
            <th>Плановый период</th>
            <th>Комментарий</th>
            <th>Статус</th>
            <th></th>
        </tr>

        {% for event in events %}
        <tr>
            <td>{{ event.get_doctor_title() }}</td>
            <td><strong>{{ event_periods[event.id] }}</strong></td>

            <td>
                {% if event.id in event_results %}
                {% if event.id in event_results %}
                {% if event_results[event.id].doctor_comment %}
                <small class="text-muted">Врач:</small><br>
                <p> {{event_results[event.id].doctor_comment}}</p>
                {% endif %}
                {% if event_results[event.id].patient_comment %}
                <small class="text-muted">Пациент: </small><br>
                <p>{{event_results[event.id].patient_comment}}</p>
                {% endif %}
                {% endif %}
                {% endif %}
            </td>
            <td>
                {% if event_status[event.id] == 'fail' %}
                    <strong style="color: red">Не выполнено</strong>
                {% endif %}
                {% if event_status[event.id] == 'progress' %}
                    <strong style="color: gray">Ожидание</strong>
                {% endif %}
                {% if event_status[event.id] == 'delay' %}
                    <strong style="color: yellow">С опозданием</strong>
                {% endif %}
                {% if event_status[event.id] == 'done' %}
                    <strong style="color: green">Выполено</strong>
                {% endif %}
            </td>
            <td>
                <ul>
                    {% if event.id in event_results %}

                    {% if not event.need_confirmation_doctor and not event.need_confirmation_patient %}
                    <li>Не требует подтверждения.</li>
                    {% endif %}


                    {% if event_results[event.id].doctor_confirmation %}
                    <li>Подтверждено врачом: {{event_results[event.id].get_doctor_confirmation()}}</li>
                    {% else %}
                        {% if event.notify_doctor and event.need_confirmation_doctor %}
                            <li>Отправлено напоминание для врача {{ event_notifications[event.id]}}, ожидает подтверждения
                            </li>
                        {% endif %}

                        {% if event.notify_doctor and not event.need_confirmation_doctor %}
                            <li>Отправлено напоминание для врача {{ event_notifications[event.id]}}, подтверждение не требуется
                            </li>
                        {% endif %}
                    {% endif %}

                    {% if event_results[event.id].patient_confirmation %}
                        <li>Подтверждено пациентом: {{event_results[event.id].get_patient_confirmation() }}</li>
                    {% else %}

                        {% if event.notify_patient and event.need_confirmation_patient %}
                            <li>Отправлено напоминание для пациента {{ event_notifications[event.id]}}, ожидает подтверждения
                            </li>
                        {% endif %}

                        {% if event.notify_patient and not event.need_confirmation_patient %}
                            <li>Отправлено напоминание для пациента {{ event_notifications[event.id]}}, подтверждение не требуется
                            </li>
                        {% endif %}
                    {% endif %}

                    {% else %}
                    <li>Напоминания пока не отправлены</li>
                    {% endif %}

                </ul>
            </td>
        </tr>
        {% endfor %}

    </table>
</div>

</body>